
### http的缺点

主要不足表现在如下几个方面：

1. 通信使用明文（不加密），内容可能会被窃听
2. 不验证通信方的身份，因此可能遭遇伪装
3. 无法证明报文的完整性，所以有可能已被篡改
4. 某些特定web服务器和特定web浏览器存在安全漏洞
其他未加密的协议也存在这类问题


#### 1.通信使用明文可能被窃听

http本身不具有加密功能，无法做到对通信整体（使用http协议通信的请求和响应内容）进行加密，即：http报文使用明文（未经加密的报文）方式传送

TCP/IP协议族的通信机制：通信内容在所有通信线路上都可能被窥视

应对措施：对通信进行加密处理防止被窃听

加密对象：

①.通信的加密

http协议没有加密机制，可以通过SSL（Secure Socket Layer:安全套接层）或TLS（Transport Layer Security:安全层传输协议）组合使用，

加密http的通信内容，这就是常说的https（超文本传输安全协议）

②.内容的加密

http协议没有加密机制，对传输的内容本身进行加密，即报文实体主体部分；客户端对请求报文加密处理后传输，但前提是客户端和服务器都具有加密和解密机制，

主要应用于WEB服务中（但仍然有被篡改的风险）



#### 2.不验证通信方身份，可能遭遇伪装

http协议中请求和响应不会对通信方进行确认，即存在“服务器是否是发送请求中URI真正指定的主机。返回的响应是否真的返回到实际提出请求的客户端”等类似问题

任何人都可以发起请求，服务器只要接收到请求，不管对方是谁都会返回一个响应（仅限于发送端IP和端口号没有被WEB服务器设定限制访问的前提下）

http协议的隐患有以下几点：

①.无法确定请求发送至目标的web服务器是否是按真实意图返回响应的服务器；有可能是已伪装的服务器

②.无法确定响应返回到的客户端是否是按真实意图接受响应的那个客户端；有可能是已伪装的客户端

③.无法确定正在通信的对方是否具备访问权限；因为某些web服务器保存有重要信息，只发给特定用户通信的权限

④.无法判断请求来自何方

⑤.即使时无意义的请求也会接收，无法阻止海量请求下的D0S攻击（Denial of Service:拒绝服务攻击）


#### 3. 无法证明报文完整性，可能已遭篡改

完整性：指信息的准确度，若无法证明其完整性，意味着无法判断信息是否正确

http协议无法证明通信的报文完整性，因此，请求或者响应在传输过程中，如果遭到篡改，是无法知道的；类似这种请求或响应传输中被攻击者拦截篡改的攻击

称为中间人攻击（Man-in-the-Middle attack,MITM）

防止篡改：常用的方法有MD5和SHA-1等散列值校验的方法，以及来确认文件的数字签名方法


------
### HTTP+加密+认证+完整性保护=HTTPS

1. 通常把添加了加密和身份认证机制的http协议称为https（HTTP Secure）；证书可证明服务器或者客户端的身份
2. https相当于身披SSL外壳的http
3. https并非应用层的一种新协议，而是在http通信接口部分用SSL（Secure Socket Layer：安全套接字层）和TLS（Transport Layer Security：安全层传输协议）协议代替
4. 通常，http和TCP直接通信，当使用SSL时，先由http和SSL通信，再由SSL和TCP通信
5. SSL是独立于http的协议，其他应用层的如SMTP何Telnet等协议都可以配合SSL进行使用



#### 1.加密技术

SSL采用公开密钥加密（Public-key cryptography）的加密处理方式，加密方法中加密算法是公开的，但密钥是保密的，以保持加密方法的安全性（密钥用来对已经加密的内容进行解密）

加密和解密通用一个密钥的方式称为共享密钥加密（Common key crypto system），也称为对称密钥加密

① 公开密钥加密方式：

公开密钥加密使用一对非对称密钥，一把叫做私有密钥（private key），一把叫做公开密钥（public key）

过程：发送密文的一方使用对方公开的密钥进行加密，对方收到被加密信息后，使用自己的私有密钥进行解密（要想根据密文和公开密钥解密，理论上可以，但实际操作起来，非常困难）

②HTTPS采用混合加密机制

https采用共享密钥加密和公开密钥加密两者并用的混合加密机制。若密钥可实现安全交换，则可能仅使用公开密钥加密（公开密钥加密相比共享密钥加密，速度较慢）

实际运用中应该合理运用两种加密机制的优势，组合起来进行通信（交换密钥环节利用公开密钥加密方式，建立通信交换报文阶段使用共享加密机制）



#### 2. 证书

由数字证书认证机构（CA:Certificate Authority）和其他相关机关颁发的公开密钥证书

处于客户端和服务器双方都可信赖的第三方机构立场，对通过申请的服务器公开密钥做数字签名，分配该公开密钥，将其与共钥证书绑定，然后服务器传给客户端，以进行公开密钥加密方式通信；

收到证书的客户端使用数字证书认证机构的公开密钥，对服务器证书的数字签名进行认证，然后明确2点：

①.认证服务器的公开密钥是真实有效的数字证书认证机构

②.服务器的公开密钥是指的信赖的

作用：

①.证明通信方的服务器是否规范

②.确认对方服务器背后运营的企业是否真实存在（拥有该功能的证书就是EV SSL证书：Extended Validation SSL Cetificate ）；特点：浏览器背景色是绿色的



#### 3.HTTPS安全通信机制

HTTPS通信过程：

①.客户端发送Client Hello报文开始通信，报文中包含客户端支持的SSL指定版本、加密组件、列表等

②.服务器接收到请求报文时，在响应报文中包含SSL版本以及加密组件发送Server Hello（加密组件内容从接收到的客户端加密组件中筛选出来）

   然后服务器发送Certificate报文，其中包含公开密钥证书

   最后服务器发送Server Hello Done报文通知客户端，最初阶段的SSL握手协商部分结束

③.第一次握手结束，客户端Client Key Exchange报文回应，报文中包含通信加密中使用的一种名为Pre-master sercet的随机密码串（该报文已用上一步骤的公开密钥进行加密）

   接着客户端你继续发送Change Cipher Spec报文，该报文提示服务器，在此报文之后的通信采用Pre-master sercet密钥加密

   最后客户端发送Finished报文；该报文包含通信连接至今全部报文的整体校验值（这次握手能否成功，以服务器是否可以正确解密报文为判断标准）

④.服务器同样发送Change Cipher Spec报文

   服务器同样发送Finisher报文

⑤.服务器和客户端Finished报文交换完成后，SSL连接完成，通信收到SSL保护，

⑥.应用层协议开始通信，即HTTP请求

⑦.最后由客户端断开连接；断开连接时，发送close_notify报文，然后发送TCP FIN报文关闭与TCP的通信

上面的通信过程中，应用层发送数据时会附加MAC（Message Authentication Code）报文摘要，MAC可查询报文是否遭受篡改，保护报文完整性

通信流程图（服务器公开密钥证书建立HTTPS的过程）



HTTPS使用SSL（Secure Socket Layer：安全套接字层）和TLS（Transport Layer Security：安全层传输协议）这两种协议

△ ：使用SSL时，处理速度回变慢

①.通信慢：通信时候大量消耗CPU及内存资源，相比较HTTP而已，网络负载可能变慢2-100倍（通信量增加）

②.加密处理：在服务器和客户端都要进行加密和解密，更多的消耗了服务器和客户端硬件资源，导致负载增强

改善方案：使用SSL加速器（专用服务器），为SSL通信专硬件，可以提高数倍SSL计算你速度，仅在SSL通信处理时发挥作用，以分担负载。


### https通信存在的问题

1. 与纯文本通信相比，https通信会消耗更多的CPU以及内存资源。平摊到每一台计算机上时能够处理的请求数量必定会随之减少
2. 节约购买证书的开销

建议：

非敏感信息使用HTTP通信，包含个人敏感信息用HTTPS

### WEB安全防范
#### 1. XSS 攻击
XSS 攻击全称跨站脚本攻击，是利用html可以执行<script>alert(1)</script>的特性，想尽办法将脚本注入页面中的攻击手段。XSS攻击有两种，一种是通过修改浏览器URL导致脚本被注入到页面，另一种是通过输入框将脚本代码注入数据库。前面一种会被chrome浏览器自动防御攻击（但最好还是手动也防御一下），后面一种则需要我们手动防御，推荐使用'xss'库的白名单过滤防御方法：
```javascript
const xss = require('xss')
let html = xss('<h1 id="title">XSS Demo</h1><script>alert("xss");</script>')
// -> <h1>XSS Demo</h1>&lt;script&gt;alert("xss");&lt;/script&gt;
```
#### 2. CSRF 攻击
CSRF中文名为跨站请求伪造

CSRF攻击是源于Web的隐式身份验证机制！Web的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，
但却无法保证该请求是用户批准发送的。CSRF攻击的问题一般是由服务端解决，

防范 CSRF 攻击可以遵循以下几种规则：

1. Get 请求不用于对数据进行修改
2. Cookie设置HTTP Only
3. 接口设置禁止跨域
4. 请求时附带验证信息，比如验证码或者 Token

#### 3. 点击劫持
点击劫持是一种视觉欺骗的攻击手段。攻击者将需要攻击的网站通过 iframe 嵌入自己的网页中，并将 iframe 设置为透明，然后诱使用户在该页面上进行操作，此时用户将在不知情的情况下点击透明的iframe页面（偸yck大佬一张图会不会被抓┭┮﹏┭┮）：

防御方法：
还是让后端大佬解决，使用一个HTTP响应头——X-Frame-Options。X-Frame-Options可以说是为了解决点击劫持而生的，

它有三个可选的值：

1. DENY：浏览器会拒绝当前页面加载任何frame页面；
2. SAMEORIGIN：frame页面的地址只能为同源域名下的页面；
3. ALLOW-FROM origin：允许frame加载的页面地址；

#### 4. 中间人攻击
中间人攻击是攻击方同时与服务端和客户端建立起了连接，并让对方认为连接是安全的，但是实际上整个通信过程都被攻击者控制了。
攻击者不仅能获得双方的通信信息，还能修改通信信息。中间人攻击的本质是客户端和服务端之间的认证和信任问题。

对称加密、非对称加密、混合加密技术都没有有效防止中间人攻击，因为中间人可以截取首次传输的密钥并偷天换日，
而客户端或服务端并无法得知。

HTTPS作为防止中间人攻击的终极手段，引入证书机制解决了客户端和服务端的信任问题，从而较为有效的防止了中间人攻击。


-------
参考： https://www.cnblogs.com/imyalost/p/6233191.html

链接：https://juejin.im/post/5cd0438c6fb9a031ec6d3ab2

参考：《图解HTTP》上野·宣 著
