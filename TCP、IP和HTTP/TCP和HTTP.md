### TCP/IP的3种说法
#### 1.TCP/IP的说法一
TCP/IP是互联网相关的各类协议族的总称

网络是在TCP/IP协议族的基础上运作的

协议中存在各式各样的内容，从电缆的规格到IP地址的选定方法、寻找异地用户的方法、双方建立通讯的顺序、以及web页面显示需要的步骤等等

HTTP属于TCP/IP协议族内部的的一个子集

#### 2.TCP/IP的说法二
TCP/IP是指TCP和IP这两种协议


#### 3.TCP/IP的说法三
TCP/IP是IP协议的通信过程中，使用到的协议族的统称

### TCP/IP的分层管理
#### TCP/IP协议族分为以下四层
- 应用层
- 传输层
- 网络层
- 数据链路层
#### 分层的好处
1. 如果不分层，某个地方需要修改设计时，修改好之后就需要把全部整体都重新替换掉，分层之后就只需要替换掉变动的这一层
2. 把各个层的暴露接口规划好后，每个层次的内部设计都可以自由改动
3. 层次化之后设计变的相对简单，每个层次只去考虑自己的任务，不需要弄清其它层次的东西了

#### 4个层次分别的作用
1. 应用层
    - 应用层决定了向用户提供应用服务时通信的活动
    - HTTP协议也位于该层，用于客户端和服务端之间的通信
    - DNS服务也位于该层，提供域名到IP地址之间的解析服务，或者提供逆向从IP地址查找域名的服务
2. 传输层
    - 传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输
    - 传输层有两个性质不同的协议:TCP(传输控制协议)、UDP(用户数据包协议)
3. 网络层（又名网络互连层）
    - 用来处理在网络上流动的数据包，数据包是网络传输的最小单位
    - 规定通过怎样的路径到达对方计算机，并把数据包传送给对方
    - 网路程的作用就是在众多的选项内选择一条线路把数据从一个计算机传递到另一个计算机
4. 链路层（又名数据链路层、网络接口层）
    - 用来处理链接网络的硬件部分
    - 包括控制操作系统、硬件的设备驱动、网络适配器网卡、光纤等物理可见设备
    - 硬件上的范畴均在链路层的作用范围
#### IP协议详解
- IP协议的作用是把各种数据包传送给对方
- 确保传到对方的前提条件是IP地址和MAC地址
    - IP地址指明了节点被分配到的地址
    - MAC地址是指网卡所属的固定地址
    - IP地址可以和MAC地址进行配对
    - IP地址可以变换，但是MAC地址基本上不会改变
#### ARP协议详解
- 用于多台计算机和网络设备的中转连接
- IP间的通信依赖MAC地址
- ARP协议是一种解析地址的协议
- ARP协议根据通信方的IP地址可以反查对应的MAC地址
- `利用下一站中转设备的MAC地址，采用ARP协议搜索下一个中转目标即IP地址`
#### 通信传输流详解
TCP/TP通讯传输流

> 发送端从应用层往下走，接收端从应用层往上走
![TCP/TP通讯传输流](https://github.com/samsonCao/sam_blog/blob/master/Image/TCP.TPtransfer.png)

##### 发送端
1. 应用层(http协议) -- 发送网络请求

2. 传输层(TCP协议) -- 获取http请求报文 -- 分割报文方便传输---在各个报文上打标记序号和端口号 -- 转发到网络层

3. 网络层(IP协议) -- 增加作为通讯目的地的MAC地址 -- 转发给链路层

4. 链路层发送接收端

##### 接收端
1. 链路层 -- 接收端的服务器在链路层接收数据

2. 网络层(IP协议) -- 接收数据 -- 转发给传输层

3. 传输层(TCP协议) -- 接收数据 -- 转发到应用层

4. 应用层(http协议) -- 接收数据
`当传递到应用层时才算真正接收到由客户端发送过来的HTTP请求`


### TCP协议采用三次握手策略确保数据准确无误送达目标

1. 发送端 -- 发送一个带SNY标记的数据包给对方

2. 接收端 -- 接收到数据，回传一个带有SYN/ACK标志的数据包以示传达确认信息

3. 发送端 -- 回传一个带ACK标志的数据包，代表握手结束

> 如果握手过程中某个阶段中断，TCP协议会再次以相同的顺序发送相同的数据包
![TCP三次握手图解](https://github.com/samsonCao/sam_blog/blob/master/Image/three.png)

#### 三次握手建立连接

第一次： A我喜欢你哦，你听到了么？

第二次： B我也喜欢你哦，你听到了么？

第三次： A我听到了，我们在一起吧！


#### 四次挥手断开连接

第一次： A我不喜欢你了，我们分手吧？

第二次： B我知道你要分手了。但是，等一下，我还有话给你说

第三次： B我说完了，我们现在可以分手了

第四次: A好的，再见


#### 为什么建立连接是三次握手，断开连接是四次挥手

这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，

把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，

仅仅表示对方不再发送数据了但是还能接收数据，己方也未必全部数据都发送给对方了，所以己方可以立即close，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送。


#### 如果已经建立了连接，但是客户端突然出现故障了怎么办？

TCP还设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。

服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为2小时，

若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75秒钟发送一次。

若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。


----

### 完整的http通信过程
客户端`输入链接`http或者https -- `DNS查询`ip地址为20X.189.105.111

-- 20X.189.105.111`ip地址发给客户端` -- HTTP协议生成针对目标web服务器的`HTTP请求报文`(请给我资源)

-- TCP协议`分隔HTTP请求`报文为多段方便传输 -- `三次握手`把每个报文段传给对方

-- `IP协议`搜索对方的地址，一边中转一边传送 -- `TCP协议`从对方`接收`报文

-- `重组(报文)`到达的报文 -- `HTTP协议`对web服务器请求的内容处理

-- 转到具体的20X.189.105.111服务器获取资源 -- 获取请求的资源

-------`反向执行上述过程发送给浏览器` -- 浏览器接收资源

-- 合并资源 --  生成dom树

-- 生成css树 -- dom树和css树合并

-- 计算盒模型位置 -- 渲染重绘、重排

-- 生成页面，展示到浏览器上上面

------
