## babel 内置插件的分类

- transform plugin 语法转换 比如 class 转 function。
  - 在 babel6 时，分别用 preset-es2015、 preset-es2016 等来维护相应的 transform plugin，但在 babel7 的时候就改为 preset env 了

- proposal plugin 特性转换
  - api polyfill 支持新的 api，比如：Array.prototype.find 新的数组 api 需要运行环境中生成
  - react、flow、typescript 转换为 js
    - 单独的插件，preset-jsx、preset-typescript、preset-flow
  - stage0 到 stage4 阶段的各种新特性转换为运行环境支持 js 语法
  - babel6 的时候有 babel-state-x 的 preset，分别放不同阶段的特性，但是这个 preset 是变化的（每年都在变），比较难以维护，所以 babel7 以后就改成 plugin-proposal-xxx 了

- syntax plugin
  - syntax plugin 只是在 parserOptions 中放入一个 flag 让 parser 知道要 parse 什么语法，最终的 parse 逻辑还是 babel parser（babylon） 实现的
  - 这些插件的目的就是让 parser 能够正确的解析对应的语法成 AST

- preset
  - 不同版本的语言标准支持： preset-es2015、preset-es2016 等，babel7 后用 preset-env 代替
  - 未加入标准的语言特性的支持： 用于 stage0、stage1、stage2 的特性，babel7 后单独引入 proposal plugin
  - 用于 react、jsx、flow 的支持：分别封装相应的插件为 preset-react、preset-jsx、preset-flow，直接使用对应 preset 即可

- helper
  - babel 设计了插件之间共享逻辑的机制，就是 helper。
  - helper 分为两种：
    - 一种是注入到 AST 的运行时用的全局函数
    - 一种是操作 AST 的工具函数，比如变量提升这种通用逻辑

## 从目标语言到目标浏览器
> 目标环境那么多，浏览器版本、node 版本、electron 版本每年都在变，怎么做到精准?

- compat-table 提供了每个特性在不同环境中的支持版本

- electron 有自己的版本，要支持 electron 得需要 electron 版本和它用的 chromium 的版本的对应关系。[electron 版本到 chromium 版本的映射关系](https://github.com/Kilian/electron-to-chromium)

- browserslist 开发者怎么指定环境 [学习文档](https://github.com/browserslist/browserslist#queries)

- @babel/preset-env

```javascript
{
    "presets": [["@babel/preset-env", { 
        "targets": "> 0.25%, not dead", // 指定 browserslist 指定目标环境范围
        "useBuiltIns": "usage",// or "entry" or "false" 指定每个文件引入用到的
        "corejs": 3 //指定core的版本
    }]]
}
```


